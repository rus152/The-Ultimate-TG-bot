# Инструкции по установке и настройке провайдеров ASR

## 1. Установка OpenAI Whisper (по умолчанию)

Whisper устанавливается автоматически при установке зависимостей:

```bash
pip install -r requirements.txt
```

### Настройка Whisper в .env:
```
ASR_PROVIDER=whisper
ASR_MODEL_NAME=turbo
ASR_DEVICE=auto
ASR_LANGUAGE=ru
```

### Доступные модели Whisper:
- `tiny` - Самая быстрая, но менее точная
- `base` - Балансирует скорость и точность
- `small` - Хорошая точность
- `medium` - Высокая точность
- `large` - Максимальная точность
- `turbo` - Оптимизированная для скорости

## 2. Установка NVIDIA NeMo (опционально)

### Требования:
- CUDA-совместимая видеокарта
- CUDA Toolkit 11.8+
- Python 3.8+

### Установка NeMo:
```bash
# Основная установка
pip install nemo_toolkit[asr]

# Или для разработки
pip install nemo_toolkit[asr,nlp]
```

### Настройка NeMo в .env:
```
ASR_PROVIDER=nemo
ASR_MODEL_NAME=nvidia/parakeet-tdt-0.6b-v2
ASR_DEVICE=cuda
```

### Доступные модели NeMo:
- `nvidia/parakeet-tdt-0.6b-v2` - Быстрая модель (600M параметров)
- `nvidia/parakeet-tdt-1.1b` - Средняя модель (1.1B параметров)

## 3. Переключение между провайдерами

### Способ 1: Через переменные окружения
Измените в файле `.env`:
```
ASR_PROVIDER=whisper  # или nemo
```

### Способ 2: Через команду в боте
Отправьте команду `/asr_status` для проверки текущего провайдера

## 4. Оптимизация производительности

### Для Whisper:
- Используйте `ASR_DEVICE=cuda` для GPU ускорения
- Выберите оптимальную модель для ваших потребностей
- Для быстрой обработки используйте `turbo` модель

### Для NeMo:
- Обязательно используйте `ASR_DEVICE=cuda`
- NeMo поддерживает пакетную обработку для множественных файлов
- Модели NeMo часто более эффективны для длинных аудиозаписей

## 5. Устранение неполадок

### Проблемы с Whisper:
- Если модель не загружается: проверьте доступность GPU
- Медленная обработка: попробуйте меньшую модель
- Ошибки памяти: используйте `ASR_DEVICE=cpu`

### Проблемы с NeMo:
- Ошибка импорта: убедитесь, что NeMo установлен правильно
- CUDA ошибки: проверьте совместимость CUDA
- Модель не загружается: проверьте интернет-соединение

## 6. Мониторинг и отладка

### Команды бота:
- `/asr_status` - Проверка статуса ASR
- `/check` - Проверка очереди обработки

### Логи:
Проверьте файл `bot.log` для диагностики проблем:
```bash
tail -f bot.log | grep -i asr
```

## 7. Дополнительные возможности

### Batch обработка (только NeMo):
NeMo поддерживает одновременную обработку нескольких файлов, что может быть эффективнее для больших объемов данных.

### Настройка языка:
- Оставьте `ASR_LANGUAGE=` пустым для автоопределения
- Укажите код языка для принудительного использования (например, `ru`, `en`, `es`)

## 8. Производительность

### Сравнение провайдеров:

| Критерий | Whisper | NeMo |
|----------|---------|------|
| Скорость | Средняя | Высокая |
| Точность | Высокая | Очень высокая |
| Размер модели | Средний | Большой |
| Поддержка языков | 99+ | Ограничена |
| Пакетная обработка | Нет | Да |
| Требования GPU | Опционально | Обязательно |
